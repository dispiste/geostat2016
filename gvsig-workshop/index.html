<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>R from gvSIG perspective, an introduction to gvSIG geoprocessing</title>

		<link rel="stylesheet" href="css/reveal.css">
		<!--
        <link rel="stylesheet" href="css/theme/black.css">
        <link rel="stylesheet" href="css/theme/white.css">  +1
        <link rel="stylesheet" href="css/theme/league.css">
        <link rel="stylesheet" href="css/theme/beige.css">  +1
        <link rel="stylesheet" href="css/theme/sky.css">
        <link rel="stylesheet" href="css/theme/night.css">
        <link rel="stylesheet" href="css/theme/serif.css">  +1
        <link rel="stylesheet" href="css/theme/simple.css">
        <link rel="stylesheet" href="css/theme/solarized.css">
        
        -->
        
        <link rel="stylesheet" href="css/theme/whitegvsig.css">
        

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
                    <h2>R from gvSIG perspective</h2>
                    <h3>An introduction to gvSIG geoprocessing</h3>
                    <p>Geostat course, Albacete 2016</p>
                    <p>Cesar Martinez Izquierdo - <a href="http://www.scolab.es" target="_blank">www.scolab.es</a></p>
                    <p><a href="http://www.gvsig.com" target="_blank">gvSIG Association</a></p>
                </section>
				<section>
                    <h2>Contents</h2>
                    <ul>
                        <li>Workshop goals</li>
                        <li>Software installation</li>
                        <li>Introduction to gvSIG</li>
                        <li>Interacting with R</li>
                        <li>Exercises</li>
                        <!--<li>Getting documentation</li> -->
                    </ul>
                </section>
				<section>
                    <h2>Workshop goals</h2>
                    <ul>
                        <li>Get an overview of gvSIG, a full featured desktop GIS software</li>
                        <li>Learning about how to use R from gvSIG</li>
                        <li>Demonstrate gvSIG geoprocessing and visualization capabilities, using a case study</li>
                    </ul>
                </section>
				<section>
                    <section>
                        <h2>Software installation</h2>
                        <p>The following software is required for the course:</p>
                        <ul>
                            <li>gvSIG 2.3.0 rc4 (or later)</li>
                            <li>gvSIG-Rexternal (gvSIG plugin)</li>
                            <!--<li>JGrass (gvSIG plugin)</li>-->
                            <li>R statistical software</li>
                        </ul>
                        <p>Press <em>Down</em> key for details</p>
                    </section>
                    <section>
                        <h2>gvSIG 2.3.0 rc4 (or later)</h2>
                        <ul>
                            <li>Get the software from the <a href="http://www.gvsig.com/en/products/gvsig-desktop/development-versions-downloads" target="_blank"><em>Development versions download</em></a> section at <a href="http://www.gvsig.com" target="_blank">gvsig.com</a></li>
                            <li>The installable version is recommended</li>
                            <li>But you can also use the portable version (no installation required)</li>
                            <li>If using Linux, choose the gvSIG version suitable for your Linux version (e.g. Ubuntu 16.04 vs 14.04)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>R statistical software</h2>
                        <p>Download and install from <a href="https://cran.r-project.org/" target="_blank">CRAN</a></p>
                    </section>
                    <section>
                        <h2>gvSIG-Rexternal (gvSIG plugin)</h2>
                        <ul>
                            <li>Download from the <em>dist</em> folder of <a href="https://github.com/dispiste/gvSIG-rexternal" target="_blank">the plugin Github repo</a>.
                            You need the last available .gvspkg file
                            (<a href="https://github.com/dispiste/gvSIG-rexternal/raw/master/dist/gvSIG-desktop-2.3.0-org.gvsig.rexternal.app.mainplugin-1.0.2-6-testing-all-all-j1_7.gvspkg" target="_blank">version 1.0.2-6</a> as of October 2016)</li>
                            <li>Install using gvSIG <em>Add-ons manager</em> (Menu: <em>Tools</em> -> <em>Add-ons manager)</em></li>
                            <li>Choose <em>Installation from file</em> to install the downloaded .gvspkg file</li>
                            <li>Select Rexternal from the list of available plugins</li>
                            <li>Note that you <em>may</em> need to execute gvSIG as <em>Administrator</em> in order to install plugins in Windows</li>
                    </section>
                    <section>
                        <h2>gvSIG-Rexternal (gvSIG plugin)</h2>
                        <p><img data-src="img/add-on-from-file.png"></p>
                    </section>
                    <section>
                        <h2>gvSIG-Rexternal (gvSIG plugin)</h2>
                        <p><img data-src="img/add-on-rexternal.png"></p>
                    </section>
                    <section>
                        <h2>gvSIG-Rexternal (II)</h2>
                        <p>Test that RExternal is correctly installed by launching <em>RShell</em> using the gvSIG <em>Scripting
                           launcher</em></p>
                        <img data-src="img/scripting-launcher0.png">
                    </section>
                    <section>
                        <h2>gvSIG-Rexternal (III)</h2>
                        <p>It should open a new R console</p>
                        <img data-src="img/new-rconsole.png">
                        <p>Check the next slide if you find any problem</p>
                    </section>
                    <section>
                        <h2>gvSIG-Rexternal (IV)</h2>
                        <ul>
                            <li>RExternal tries to guess the R installation folder, but you may need
                           to manually configure it</li>
                            <li>If needed, edit the file <code>gvSIG/extensiones/org.gvsig.rexternal.app.mainplugin/rpath.properties</code>
                            within your gvSIG installation folder</li>
                            <li>You need to write the full path to the R executable, as shown
                            in the examples</li>
                        </ul>
                        <pre><code>
# File: gvSIG/extensiones/org.gvsig.rexternal.app.mainplugin/rpath.properties
# keep this empty to search R binary in current PATH
R_BIN_PATH=

## You can manually set the path to the R binary. Examples:
#
# Typical path for Linux:
# R_BIN_PATH=/usr/bin/R
# Typical path for Windows 64 bits:
# R_BIN_PATH=c:\\Program Files\\R\\R-3.2.3\\bin\\x64\\R.exe
# Typical path for Windows 32 bits:
# R_BIN_PATH=c:\\Program Files\\R\\R-3.2.3\\bin\\x32\\R.exe

## Note that in Windows, the path to R will likely change when
## you update R to a newer version!!!!!

## You can also use an internally-installed R instance
# R_BIN_PATH=R/bin/R
                        </code></pre>
                        
                    </section>
                    <section>
                        <h2>Install extra symbol libraries (gvSIG plugins)</h2>
                        <ul>
                            <li>Install using gvSIG <em>Add-ons manager</em> (Menu: <em>Tools</em> -> <em>Add-ons manager)</em></li>
                            <li>Choose <em>Standard installation</em></li>
                            <li>Install all the available symbol libraries</li>
                            <li>Note that you <em>may</em> need to execute gvSIG as <em>Administrator</em> in order to install plugins in Windows</li>
                    </section>

                    <section>
                        <h2>R packages</h2>
                        <p>Install the following R packages: rgdal, sp and raster.</p><p>Type in R console:</p>
                        <pre><code>
install.packages("sp")
install.packages("raster")
install.packages("rgdal")
                        </code></pre>
                    </section>
                </section>
                
				<section>
                    <section>
                        <h2>Introduction to gvSIG</h2>
                        <ul>
                            <li>Overview</li>
                            <li>Vector layers</li>
                            <li>Raster layers</li>
                            <li>Remote services</li>
                            <li>3D views</li>
                            <li>Geoprocessing</li>
                            <li>Scripting</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Overview</h2>
                        <ul>
                            <li>gvSIG is a desktop geographic information system (GIS) application</li>
                            <li>Available for Linux, Windows and Mac</li>
                            <li>Translated to 18 languages</li>
                            <li>Long history: first version released on 2004</li>
                            <li>GPL3 license</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Overview (II)</h2>
                        <ul>
                            <li>Vector and raster data support</li>
                            <li>Support for data bases, remote services (OGC's WMS, WMTS, WFS, WCS, etc) and other tile providers (OSM/Map Quest, Google, etc)</li>
                            <li>Vector editing capabilities</li>
                            <li>3D visualization</li>
                            <li>Map composer</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Overview (III)</h2>
                        <ul>
                            <li>Geoprocessing tools and process modeller</li>
                            <li>Easily extensible using the integrated scripting framework and the Add-on manager</li>
                            <li>Different scripting languages supported (Python/Jython, Groovy, R/Renjin, Javascript and Scala)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>gvSIG documents</h2>
                        <p><img data-src="img/overview1.png"></p>
                    </section>
                    <section>
                        <h2>gvSIG documents</h2>
                        <ul>
                            <li>Views: data visualization, processing and editing</li>
                            <li>Table: alphanumeric information visualization/editing</li>
                            <li>Map: map composition, printing and high quality exporting</li>
                            <li>Charts: create simple charts</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Views: Add layer</h2>
                        <p><img data-src="img/view-add-layer1.png"></p>
                    </section>
                    <section>
                        <h2>Vector data</h2>
                        <ul>
                            <li>Advanced symbology and labelling</li>
                            <li>Lots of formats supported: SHP, PostGIS, DXF, DGN, GML, KML, LAS (LIDAR), CSV and Excel points...</li>
                            <li>Plus all the formats supported by OGR</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Add layer: files</h2>
                        <p><img data-src="img/add-layer1.png"></p>
                    </section>
                    <section>
                        <h2>Symbol library</h2>
                        <p><img data-src="img/symbol-library1.png"></p>
                    </section>
                    <section>
                        <h2>Symbol library</h2>
                        <p><img data-src="img/symbol-library2.png"></p>
                    </section>
                    <section>
                        <h2>Raster data</h2>
                        <ul>
                            <li>Uses GDAL to read most formats</li>
                            <li>Analysis view, colour tables, histograms, etc</li>
                        </ul>
                    </section>
                    <section>
                        <h2>WMTS layers</h2>
                        <p><img data-src="img/wmts-layer.png"></p>
                    </section>
                    <section>
                        <h2>3D views</h2>
                        <ul>
                            <li>Creates <b>3D views from 2D views</b> (layers, symbology, etc)</li>
                            <li>Viewport and layer <b>synchronization</b> between views</li>
                            <li><b>Spheric</b> and <b>flat</b> modes</li>
                            <li>Anaglyph mode</li>
                        </ul>
                    </section>
                    <!--
                    <section data-background-iframe="https://youtube.com/embed/-do5RfpJRCY?autoplay=1&controls=0&showinfo=0&autohide=1">
                        <h2>3D views: LIDAR data</h2>
                    </section> -->
                    <section>
                        <h2>3D views: LIDAR data</h2>
                        <iframe height="600" width="1000" 
                            src="https://youtube.com/embed/-do5RfpJRCY?autoplay=0&controls=1&showinfo=0&autohide=1"></iframe>
                        <!-- <iframe height="600" width="1000" 
                            src="https://youtube.com/embed/-do5RfpJRCY?autoplay=1&controls=0&showinfo=0&autohide=1"></iframe> -->
                    </section>
                    <section>
                        <h2>3D views: vector extrusion</h2>
                        <iframe height="600" width="1000" 
                            src="https://youtube.com/embed/gBVRxBF9PJQ?autoplay=0&controls=1&showinfo=0&autohide=1"></iframe>
                    </section>
                    <section>
                        <h2>Geoprocessing</h2>
                        <p><img data-src="img/geoprocessing-toolbox.png"></p>
                    </section>
                    <section>
                        <h2>Geprocessing</h2>
                        <ul>
                            <li>Raster and vector processing tools</li>
                            <li>355 tools available (including Sextante)</li>
                            <li>General purpose and specific (hydrology, forestry, etc) tools</li>
                            <li>More tools available as plugins: <a href="https://github.com/moovida/hydrologis4gvsig" target="_blank">JGrass tools</a> (forestry, LIDAR, hydrology...)</li>
                            <li>Creation of new tools is simple (Python, Java, R...)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Process modeller</h2>
                        <p><img data-src="img/geoprocess-modeler1.png"></p>
                    </section>
                    <section>
                        <h2>Process modeller</h2>
                        <p><img data-src="img/geoprocess-modeler2.png"></p>
                    </section>
                    <section>
                        <h2>Process modeller</h2>
                        <ul>
                            <li>Simple while powerful tool to define models or automating processing flows</li>
                            <li>Useful for streamlining complex analysis</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Scripting framework</h2>
                        <ul>
                            <li>Useful for extending gvSIG or automate tasks</li>
                            <li>Allows to create:</li>
                            <ul>
                                <li>new buttons, menu entries, forms</li>
                                <li>new geoprocessing tools (and use them in the modeller)</li>
                            </ul>
                            <li>Integrated scripting composer and launcher</li>
                            <li>Integrated console (Python)</li>
                            <li>Simplifies creation of new gvSIG plugins</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Scripting framework</h2>
                        <p><img data-src="img/scripting-composer.png"></p>
                    </section>
                </section>
				<section>
                    <section>
                        <h2>Interacting with R</h2>

                        <ul>
                            <li>Two different R plugins (and approaches) in gvSIG:</li>
                            <ul>
                                <li>Renjin (Java based R implementation)</li>
                                <li>RExternal plugin (uses an external R process)</li>
                            </ul>
                            <li>They offer totally different possibilities and limitations</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Renjin</h2>
                        <ul>
                            <li>Integrated in the gvSIG Scripting framework</li>
                            <li>Makes possible to control or automate gvSIG from an R script (layer loading, accessing to layer values, etc)</li>
                            <li>Limitations:</li>
                            <ul>
                                <li>Only a small fraction of the existing R packages are available on Renjin</li>
                                <li>For the moment, no direct way to load R data frames as gvSIG tables or accessing
                                   gvSIG tables as R data frames</li>
                            </ul>
                        </ul>
                    </section>
                    <section>
                        <h2>Renjin</h2>
                        <ul>
                            <li>Installation of packages works in a different way, compared to the regular R implementation</li>
                            <li>Packages get automatically installed when the <em>library()</em> command is used</li>
                            <li>The availability of each package for Renjin can be checked on
                            <a href="http://packages.renjin.org/" target="_blank">this page</a></li>
                        </ul>
                    </section>
                    <section>
                        <h2>RExternal plugin</h2>
                        <ul>
                            <li>Allows to launch R scripts from gvSIG</li>
                            <li>Runs as an external R native process (so any R package can be used)</li>
                            <li>Provides an easy way to pass gvSIG layers as inputs to the R script and to
                                load R outputs as gvSIG layers</li>
                            <li>R scripts can be registered as gvSIG Geoprocesses and included in gvSIG models</li>
                        </ul>
                    </section>
                    <section>
                        <h2>RExternal plugin</h2>
                        <ul>
                            <li>Limitations:</li>
                            <ul>
                                <li>Requires a small script declaration (written in Python) per each R script</li>
                                <li>Data interchange is limited to input/output layers/tables</li>
                            </ul>
                        </ul>
                    </section>
                    <section>
                        <h2>RExternal plugin</h2>
                        <ul>
                            <li>The integrated R script can be very easily packaged and distributed as gvSIG
                                plugin</li>
                            <li>The user interface for the process is automatically built (based on the
                            declaration of parameters)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>RExternal plugin</h2>
                        <p><img data-src="img/registered-rprocesses.png"></p>
                    </section>
                    <section>
                        <h2>RExternal plugin</h2>
                        <p><img data-src="img/process-ui.png"></p>
                    </section>
                    <section>
                        <h2>RExternal plugin</h2>
                        <ul>
                            <p>See Exercise 3 for detailed documentation and usage examples</p>
                        </ul>
                    </section>
                </section>
                <section>
                    <h2>Exercises</h2>
<<<<<<< aa528610242fbd93900bf43fb92ff25f80853309
                    <p>Download and uncompress the
                      <a href="https://github.com/dispiste/geostat2016/raw/master/data/data.zip" target="_blank">sample data</a>
                      and <a href="https://github.com/dispiste/geostat2016/raw/master/scripts/scripts.zip" target="_blank">sample scripts</a> for the exercises</p>
=======
                    <p>Download and uncompress the
                      <a href="https://github.com/dispiste/geostat2016/raw/master/data/data.zip">sample data</a>
                      and <a href="https://github.com/dispiste/geostat2016/raw/master/scripts/scripts.zip">sample scripts</a> for the exercises</p>
>>>>>>> Spell corrections
                </section>
				<section>
                    <section>
                        <h2>Exercise 1</h2>
                        <p>Goal: getting familiar with gvSIG basics</p>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Create a new view: <em>Project Manager -> View -> New</em></li>
                            <li>Change some View properties:</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <p><img data-src="img/view-properties1.png"></p>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Change some View properties:</li>
                            <ul>
                                <li>Set a meaningful name: Spain</li>
                                <li>Configure a proper reference system for the view. We'll work with Spain data, so we'll use
                                    UTM zone 30N with ETRS89 datum (code EPSG:25830)</li>
                                    <li>It is important to set the CRS before loading any layer</li>
                            </ul>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <p><img data-src="img/view-properties-crs1.png"></p>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Load some vector layers</li>
                        </ul>
                        <p><img data-src="img/view-add-layer1.png"></p>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Load all the layers under the <em>bcn500_cnig</em> folder</li>
                            <li>They contain information about:</li>
                            <ul>
                                <li>Points: airports</li>
                                <li>Lines:  motorways, primary and secondary roads</li>
                                <li>Polygons: main agglomerations</li>
                            </ul>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Apply proper symbology to each layers (select layer in TOC & then double click on it)</li>
                            <li>You can define your own symbology or use the symbol library</li>
                            <li>Suggestion: use OSM symbols for roads and airports</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>You can load an online satellite image as background</li>
                            <li>Go to <em>Add layer -> WMTS</em></li>
                            <li>Use service <code>http://www.ign.es/wmts/pnoa-ma?request=GetCapabilities&service=WMTS</code></li>
                            <li>Connect to the service and follow the wizard</li>
                            <li>Choose the proper reference system (EPSG:25830)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Reorder the layers on TOC:</li>
                            <ul>
                                <li>move the satellite image and the polygon layer to the bottom</li>
                                <li>move the airport layer to the top</li>
                                <li>order the roads by importance</li>
                            </ul>
                            <li>You can also set the secondary roads layer to be only visible at a certain scale (on layer properties)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                            <p><img data-src="img/symbolization_result.jpg"></p>
                        <!--    <p>It should look like this</p> -->
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Create a 3D spheric view</li>
                            <li>Use terrain exaggeration to make it more impressive</li>
                            <li>Hints:</li>
                            <ul>
                                <li>You can use the mouse and shift keys to navigate faster</li>
                                <li>You'll see a reprojection artifact in the WMTS layer. You can disable it
                                 (as there is a built-in satellite image on the 3D view) or create the 2D
                                 view using EPSG:4326 to avoid this artifact</li>
                            </ul>
                            <li>Use the <em>Animation manager</em> to create a visualization</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                        <ul>
                            <li>Use the <em>Animation manager</em> to create a visualization</li>
                            <li>Set at least 5 animation steps</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 1: Views and data</h2>
                            <p><img data-src="img/symbolization-result3d.jpg"></p>
                    </section>
                </section>
				<section>
                    <section>
                        <h2>Exercise 2</h2>
                        <p>Goal: Demonstrate the geoprocessing toolbox</p>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <p>We have some information about species distribution (from the SPANISH INVENTORY OF TERRESTRIAL SPECIES)
                        and want to learn
                        about the habitat preferences of a particular species (Otis tarda).</p>
                        <p>We also have information about land cover and elevation</p>
                    </section>
                    <section data-background-image="img/Otis_tarda,_Castuera,_Estremadura,_Spain_1.jpg">
                        <h2>Hi, I am Otis tarda!!</h2>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p style="color:black">Image: Francesco Veronesi (CC BY-SA 2.0)</p>
                    </section>
                    <section data-background-image="img/Drofa_otis_tarda.jpg" data-background-size="600px">
                        <h2>I am also Otis tarda</h2>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p>&nbsp;</p>
                        <p style="color:black">Image: Governor of Volgograd Oblast (CC BY-SA 3.0)</p>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>First, we need to load the species distribution information</li>
                            <li>We have a shapefile defining a reference grid and a CSV that defines in which cells of
                            the grid the species is present</li>
                            <li>Load the layer Malla10x10_MarTierra_p.shp</li>
                            <li>Go to Project Manager and create a new table to load the CSV (otis_tarda_latin1.csv or
                            (otis_tarda_utf8.csv)</li>
                            <li>Hints:</li>
                            <ul>
                                <li>When loading the table, go to properties and select Profile: Excel</li>
                                <li>Use the latin1 csv in Windows and utf8 otherwise</li>
                                <li>Or choose the proper encoding in advanced properties tab</li>
                            </ul>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Now we need to relate the shp with the csv information, using the Join tool</li>
                            <li>From the newly created table, go to menu Table -> Create join </li>
                            <li>Choose the SHP as the first data store to join, the csv as the second one</li>
                            <li>The fields containing the related keys are <em>CUARDICULA</em> and <em>CUTM10X10</em>.</li>
                            <li>We'll only need the <em>Grupo</em>, <em>Nombre</em>, <em>Genero</em>
                             and <em>Especie</em> fields from the CSV</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Now we want to select only the cells with species presence</li>
                            <li>On the joined layer, use tool Select By Attribute (menu: Selection)</li>
                            <li>Select the records having <em>Otis tarda</em> as name, creating a new selection set</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Now we'll export the selected cells to a new layer</li>
                            <li>From the view TOC, right click on the joined layer and select Export to...</li>
                            <li>Export to a new SHP, including only selected records</li>
                            <li>Performance tip: do some cleaning, hide or remove all the previous layers</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Now we want to know in which types of land cover the species can be found</li>
                            <li>We'll cross the information and get some statistics</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Load clc2006_250 raster layer, containing land cover information for the year 2016 from the European dataset Corine Land Cover</li>
                            
                            <li>There are two equivalent class codes</li>
                                <ul>
                                    <li>The one used in the raster file (from 1 to 44)</li>
                                    <li>A hierarchical code (1, 1.1, 1.1.1, 1.1.2, 2, 2.1, etc)</li>
                                </ul>
                            <li>There is a txt file next to the layer, providing information about the class definitions and code equivalences</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Open the Geoprocessing toolbox (menu: Tools: Geoprocessing: Toolbox)</li>
                            <li>There is a large list of processes available</li>
                            <li>You can filter them using the search box (down)</li>
                            <li>Some of them are disabled because there is no suitable input layer for them in the view</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <p><img data-src="img/crop-grid.png"></p>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Use the <em>Crop grid with polygon layer</em> algorithm to extract the land cover
                            classes that overlap with the species presence areas</li>
                            <li>Then use the <em>Class statistics</em> algorithm to get the frequency of each
                            land cover class in the presence areas</li>
                            <li>Hint: The output of the Class statistics algorithm is a table, you can open it from the
                            Project Manager</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <p><img data-src="img/otis_tarda_freq1.png"></p>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <ul>
                            <li>Now you can use the elevation data for performing a similar analysis</li>
                            <li>Load the elevation data (ign_mdt200)</li>
                            <li>Use the Geoprocessing Toolbox to calculate the slope from the elevation (as slope usually influences species habitats)</li>
                            <li>Think yourself about an appropriate methodology to analyse this information</li>
                            <li>Hint: in addition to itself is not very important Now you can use the elevation data for performing a similar analysis</li>
                        </ul>
                    </section>
                </section>
				<section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Goal: Demonstrate the gvSIG-R interface using RExternal plugin</p>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>We are going to learn how to integrate R scripts in the gvSIG Geoprocessing
                        Toolbox and how to easily distribute them as new gvSIG plugins</p>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <ul>
                            <li>First we'll study the structure and code of the provided sample plugins.
                             Start by looking at the <code>geostatsplugin</code> folder. We'll have 4 components:</li>
                            <ul>
                                <li>The R script we want to integrate</li>
                                <li>A bit of Python glue-code to declare the R script parameters and methods</li>
                                <li>An small <code>autorun.py</code> script to register the script in the Toolbox</li>
                                <li>An empty <code>__init__.py</code> file</li>
                            </ul>
                            <li>There is also some .inf files but they are automatically created by gvSIG when the scripts
                            are created</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Have a closer look to each file. In <code>test.r</code> script we have: 1) a function to load some
                        libraries:</p>
                        <pre><code>
load_libraries <- function() {
  library(rgdal)
  library(raster)
  return(1)
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Have a closer look to each file. In <code>test.r</code> script we have: 2) a doalmostnothing function
                         which loads a vector layer and copies one raster from inrasterpathname to outrasterpathname:</p>
                        <pre><code>
doalmostnothing <- function(shpdsn, shpname, inrasterpathname, outrasterpathname){
  shp<-readOGR(dsn=shpdsn,layer=shpname)
  message("shp loaded")
  rasterimage<-raster(inrasterpathname)
  message("raster loaded")
  writeRaster(rasterimage, filename=outrasterpathname, format="GTiff", overwrite=TRUE)
  return (1)
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Have a closer look to each file. In gluecode.py we basically have: 1) some imports, a class
                        declaration extending from RProcess class and an __init__ method defining the path to the
                        rscript (and optionally the working directory):</p>
                        <pre><code>
import rlib
reload(rlib)
from rlib.process import *
import os

class TestProcess1(RProcess):
    def __init__(self):
        baseDir = os.path.dirname(os.path.abspath(__file__))
        rscript = os.path.join(baseDir, "rscript.r")
        RProcess.__init__(self, rscript, baseDir)
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Have a closer look to each file. In gluecode.py we basically have: 2) a defineCharacteristics method
                        with the declaration of the inputs and outputs:</p>
                        <pre><code>
    def defineCharacteristics(self):
        # Process name
        self.setName("Test R process1")
        # Process group
        self.setGroup("Geostat course")
        params = self.getParameters() 
        # Define an input vector parameter, named IN_VECTOR, of type polygon and make it mandatory
        params.addInputVectorLayer("IN_VECTOR","Input vector layer", SHAPE_TYPE_POLYGON, True)

        # Define an input raster parameter named IN_RASTER and make it mandatory
        params.addInputRasterLayer("IN_RASTER","Input raster layer", True)

        # Define an output raster layer, name "OUT_RASTER"
        self.addOutputRasterLayer("OUT_RASTER", "Output raster")
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Have a closer look to each file. In gluecode.py we basically have: 3) a callRProcess method defining
                        the methods of the R script to be called:</p>
                        <pre><code>
    def callRProcess(self, *args):
        """
        Calls the main method of the defined R script
        """
        self.R.call("load_libraries")
        self.R.call("doalmostnothing", *args)
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <ul>
                            <li>You could even omit callRProcess (then the main method of the R script would be called)</li>
                            <li>You can also define more complex callRProcess methods if you want to somehow transform or reorder
                        some parameters (see the examples on the provided sample scripts)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Have a closer look to each file. In <code>autorun.py</code> script we instance the TestProcess1 that
                        we previously declared in gluecode.py and we register it on the toolbox:</p>
                        <pre><code>
import gvsig
from gluecode import *
import gluecode

process = gluecode.TestProcess1()
process.selfregister("Scripting")
                        </code></pre>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>This is enough to have the R plugin available on the gvSIG toolbox and
                        process modeller</p>
                    </section>
                    <section>
                        <h2>Exercise 2</h2>
                        <p><img data-src="img/registered-rprocesses.png"></p>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>But we can do the same even with less code. Have a look to the <em>geostatsplugincompact</em> sample
                        plugin. It only contains:</p>
                        <ul>
                            <li>The R script(s) to be integrated</li>
                            <li>The autorun.py script, in which we do the declaration and registration of the
                            R scripts altogether</li>
                            <li>The empty __init__.py file</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>If you look to <em>autorun.py</em> in <em>geostatsplugincompact</em>, you'll notice:</p>
                        <ul>
                            <li>We have omitted the __init__ method (we use self.rscript in <em>defineCharacteristics</em> instead</li>
                            <li>We have also omitted the callRprocess method (because we have a main method in our R script)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Now you are ready to integrate your own scripts. Follow these steps</p>
                        <ul>
                            <li>Open the gvSIG scripting composer (Tools -> Development -> Scripting composer)</li>
                            <li>Create a new folder (File -> New), type the name (it will be the name of your
                            plugin) and select Type: Folder</li>
                            <li>Create the empty __init__.py script (File -> New), type: Script, language: Python,
                            save on the folder you just created</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <ul>
                            <li>Create the R script script (File -> New), type: Script, language: R. You can
                            create it from scratch or you can paste an existing R script. You could also directly copy
                            the file in the right folder, within
                            <em>${HOME}/gvSIG/plugins/org.gvsig.scripting.app.mainplugin/scripts/yourpluginname</em></li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <ul>
                            <li>Finally, create the autorun.py script (File -> New), type: Script, language: Python</li>
                            <li>You need to create a class per each R script you want to integrate</li>
                            <li>IMPORTANT: the name of the class MUST be unique (even across different plugins)</li>
                            <li>In each class, you need to declare:</li>
                            <ul>
                                <li>the path to the R script and its parameters (within the defineCharacteristics method)</li>
                                <li>the R functions to call (within the callRProcess method)</li>
                            </ul>
                            <li>And you need to write the registration code at the end of the file (outside any class declaration)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>Once you test and validate your plugin, you are ready to distribute it. It's very easy!!</p>
                        <ul>
                            <li>From the Scripting Composer, click on menu Tools -> Script package</li>
                            <li>Choose the folder you created (which contains all the scripts)</li>
                            <li>Review the form details (name, version...)</li>
                            <li>And finally select the output folder and file name</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p>This creates a .gvspkg file, which can be easily installed on other computer using gvSIG's
                        Add-on Manager</p>
                        <p>You can also contact us to get your plugin included on the <em>Standard installation list</em>. In this
                        way, your users will not need to download the package themselves</p>
                    </section>
                    <section>
                        <h2>Exercise 3</h2>
                        <p><img data-src="img/addon-manager.png"></p>
                    </section>
                </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
